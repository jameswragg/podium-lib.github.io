<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>🐠 Sharing state between podlets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link type="text/css" rel="stylesheet" href="/Podium/docs/assets/style.css" />
  <link type="text/css" rel="stylesheet" href="/Podium/docs/assets/pilcrow.css" />
  <link type="text/css" rel="stylesheet" href="/Podium/docs/assets/hljs-github.min.css"/>
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css"/>
  <link rel="shortcut icon" href="/Podium/docs/assets/podium.png" type="image/x-icon">
</head>
<body>
  <header>
    <a class="logo" href="/Podium">
      <img class="podium" src="/Podium/docs/assets/podium.png">
      Podium
    </a>
    <div class="links">
      <a href="https://github.schibsted.io/Podium" target="_blank">GitHub</a>
    </div>
  </header>
  <div class="content">
    <nav class="main-navigation">
      
      <h3>Podium</h3>
      <ul>
        <li><a href="/Podium/docs/podium/conceptual_overview.html">📚 Overview</a></li>
      </ul>
      
      <h3>Podlet Guides</h3>
      <ul>
        <li><a href="/Podium/docs/podlets/getting_started.html">🚀 Getting Started</a></li>
        <li><a href="/Podium/docs/podlets/fallbacks.html">🔌 Fallbacks</a></li>
        <li><a href="/Podium/docs/podlets/context.html">✂️ Context</a></li>
        <li><a href="/Podium/docs/podlets/assets.html">📦 Assets</a></li>
        <li><a href="/Podium/docs/podlets/proxying.html">🐠 Proxying</a></li>
        <li><a href="/Podium/docs/podlets/local_development.html">🔥 Development</a></li>
      </ul>

      <h3>Layout Guides</h3>
      <ul>
        <li><a href="/Podium/docs/layouts/getting_started.html">🚀 Getting Started</a></li>
        <li><a href="/Podium/docs/layouts/context.html">✂️ Context</a></li>
        <li><a href="/Podium/docs/layouts/unavailable_podlets.html">🔌 Unavailable Podlets</a></li>
        <li><a href="/Podium/docs/layouts/sharing_state.html">🐠 Sharing State</a></li>
        <li><a href="/Podium/docs/layouts/assets.html">📦 Assets</a></li>
        <li><a href="/Podium/docs/layouts/local_development.html">🔥 Development</a></li>
      </ul>

      <h3>API Docs</h3>
      <ul>
        <li><a href="https://github.schibsted.io/Podium/podlet/blob/master/README.md">📚 Podlet</a></li>
        <li><a href="https://github.schibsted.io/Podium/layout/blob/master/README.md">📚 Layout</a></li>
        <li><a href="https://github.schibsted.io/Podium/context/blob/master/README.md">📚 Context</a></li>
        <li><a href="https://github.schibsted.io/Podium/proxy/blob/master/README.md">📚 Proxy</a></li>
        <li><a href="https://github.schibsted.io/Podium/client/blob/master/README.md">📚 Client</a></li>
      </ul>
    </nav>
    <main class="markdown-body"><h1 id="🐠-sharing-state-between-podlets"><a class="header-link" href="#🐠-sharing-state-between-podlets"></a>🐠 Sharing state between podlets</h1>
<p>There are occasions where you will want user interaction in a podlet to inform the behaviour of other podlets. A great example of this is search. You might have one podlet that handles user search input and another podlet that displays search results.</p>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> searchField = layout.client.register({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'searchField'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7200'</span>,
});

<span class="hljs-keyword">const</span> searchResults = layout.client.register({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'searchResults'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7201'</span>,
});</code></pre><p>The recommended way for the <code>searchResults</code> podlet to react to user changes in the <code>searchField</code> is to put shared state into URL query parameters.</p>
<h2 id="sending-query-params"><a class="header-link" href="#sending-query-params"></a>Sending query params</h2>
<p>The Podium context is not the only way for a layout to communicate with its podlets. Query params can be forwarded to podlets via <code>.fetch()</code> calls.</p>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> content = podlet.fetch(context, { <span class="hljs-attr">query</span>: { <span class="hljs-attr">search</span>: req.query.search } });</code></pre><p>Continuing with our search example, when a request comes in to the layout at <code>http://localhost:7101?search=houses</code>, we forward the query parameter <code>search</code> on to both podlets.</p>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([
    searchField.fetch(ctx, { <span class="hljs-attr">query</span>: { <span class="hljs-attr">search</span>: req.query.search } }),
    searchResults.fetch(ctx, { <span class="hljs-attr">query</span>: { <span class="hljs-attr">search</span>: req.query.search } }),
]);</code></pre><p>Our podlets will then have access to the value of <code>search</code> and be able to render content accordingly. Likewise, in order to set this state, all a podlet will need to do is navigate the page to <code>http://localhost:7101?search=houses</code>.
The <code>searchField</code> podlet could do this by creating a form.</p>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"http://localhost:7101"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"GET"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"search"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre>    </main>
  </div>
  <script>
    (function () {
      var pathname = window.location.pathname.substr(1);
      var activeLink = document.querySelector('a[href="' + pathname + '"]');

      activeLink.classList.add('selected');
    })();
  </script>
</body>
</html>
