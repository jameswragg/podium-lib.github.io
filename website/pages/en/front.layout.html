Layouts are standalone HTTP services which on run time compose one or multiple Podlets (page fragments) into full webpages. Layouts are written in node.js with the @podium/layout module.

This is a Layout which will include two Podlets:

<div class="tabs"><div class="nav-tabs"><div id="tab-group-230-tab-231" class="nav-link active" data-group="group_230" data-tab="tab-group-230-content-231">Express</div><div id="tab-group-230-tab-232" class="nav-link" data-group="group_230" data-tab="tab-group-230-content-232">Hapi</div><div id="tab-group-230-tab-233" class="nav-link" data-group="group_230" data-tab="tab-group-230-content-233">Fastify</div><div id="tab-group-230-tab-234" class="nav-link" data-group="group_230" data-tab="tab-group-230-content-234">HTTP</div></div><div class="tab-content"><div id="tab-group-230-content-231" class="tab-pane active" data-group="group_230" tabindex="-1"><div><span><pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);<br><span class="hljs-keyword">const</span> Layout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/layout'</span>);<br><br><span class="hljs-keyword">const</span> layout = <span class="hljs-keyword">new</span> Layout({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myLayout'</span>,<br>    <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletA = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletA'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7100/manifest.json'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletB = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletB'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7200/manifest.json'</span>,<br>});<br><br><span class="hljs-keyword">const</span> app = express();<br>app.use(layout.middleware());<br><br>app.get(layout.pathname(), <span class="hljs-keyword">async</span> (req, res, next) =&gt; {<br>    <span class="hljs-keyword">const</span> incoming = res.locals.podium;<br><br>    <span class="hljs-keyword">const</span> [a, b] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([<br>        podletA.fetch(incoming),<br>        podletB.fetch(incoming),<br>    ]);<br><br>    res.podiumSend(<span class="hljs-string">`<br>        &lt;section&gt;<span class="hljs-subst">${a.content}</span>&lt;/section&gt;<br>        &lt;section&gt;<span class="hljs-subst">${b.content}</span>&lt;/section&gt;<br>    `</span>);<br>});<br><br>app.listen(<span class="hljs-number">7000</span>);<br></code></pre>
</span></div></div><div id="tab-group-230-content-232" class="tab-pane" data-group="group_230" tabindex="-1"><div><span><pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> HapiLayout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/hapi-layout'</span>);<br><span class="hljs-keyword">const</span> Layout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/layout'</span>);<br><span class="hljs-keyword">const</span> Hapi = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hapi'</span>);<br><br><span class="hljs-keyword">const</span> app = Hapi.Server({<br>    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">7000</span>,<br>});<br><br><span class="hljs-keyword">const</span> layout = <span class="hljs-keyword">new</span> Layout({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myLayout'</span>,<br>    <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletA = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletA'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7100/manifest.json'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletB = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletB'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7200/manifest.json'</span>,<br>});<br><br>app.register({<br>    <span class="hljs-attr">plugin</span>: <span class="hljs-keyword">new</span> HapiLayout(),<br>    <span class="hljs-attr">options</span>: layout,<br>});<br><br>app.route({<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,<br>    <span class="hljs-attr">path</span>: layout.pathname(),<br>    <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">request, h</span>) =&gt;</span> {<br>        <span class="hljs-keyword">const</span> incoming = request.app.podium;<br><br>        <span class="hljs-keyword">const</span> [a, b] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([<br>            podletA.fetch(incoming),<br>            podletB.fetch(incoming),<br>        ]);<br><br>        h.podiumSend(<span class="hljs-string">`<br>            &lt;section&gt;<span class="hljs-subst">${a.content}</span>&lt;/section&gt;<br>            &lt;section&gt;<span class="hljs-subst">${b.content}</span>&lt;/section&gt;<br>        `</span>);<br><br>    },<br>});<br><br>app.start();<br></code></pre>
</span></div></div><div id="tab-group-230-content-233" class="tab-pane" data-group="group_230" tabindex="-1"><div><span><pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> fastifyLayout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/fastify-layout'</span>);<br><span class="hljs-keyword">const</span> fastify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fastify'</span>);<br><span class="hljs-keyword">const</span> Layout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/layout'</span>);<br><br><span class="hljs-keyword">const</span> app = fastify();<br><br><span class="hljs-keyword">const</span> layout = <span class="hljs-keyword">new</span> Layout({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myLayout'</span>,<br>    <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletA = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletA'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7100/manifest.json'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletB = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletB'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7200/manifest.json'</span>,<br>});<br><br>app.register(fastifyLayout, layout);<br><br>app.get(layout.pathname(), <span class="hljs-keyword">async</span> (request, reply) =&gt; {<br>    <span class="hljs-keyword">const</span> incoming = reply.app.podium;<br><br>    <span class="hljs-keyword">const</span> [a, b] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([<br>        podletA.fetch(incoming),<br>        podletB.fetch(incoming),<br>    ]);<br><br>    reply.podiumSend(<span class="hljs-string">`<br>        &lt;section&gt;<span class="hljs-subst">${a.content}</span>&lt;/section&gt;<br>        &lt;section&gt;<span class="hljs-subst">${b.content}</span>&lt;/section&gt;<br>    `</span>);<br>});<br><br><span class="hljs-keyword">const</span> start = <span class="hljs-keyword">async</span> () =&gt; {<br>    <span class="hljs-keyword">try</span> {<br>        <span class="hljs-keyword">await</span> app.listen(<span class="hljs-number">7000</span>);<br>        app.log.info(<span class="hljs-string">`server listening on <span class="hljs-subst">${app.server.address().port}</span>`</span>);<br>    } <span class="hljs-keyword">catch</span> (err) {<br>        app.log.error(err);<br>        process.exit(<span class="hljs-number">1</span>);<br>    }<br>}<br>start();<br></code></pre>
</span></div></div><div id="tab-group-230-content-234" class="tab-pane" data-group="group_230" tabindex="-1"><div><span><pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> { HttpIncoming } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/utils'</span>);<br><span class="hljs-keyword">const</span> Layout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/layout'</span>);<br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);<br><br><span class="hljs-keyword">const</span> layout = <span class="hljs-keyword">new</span> Layout({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myLayout'</span>,<br>    <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletA = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletA'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7100/manifest.json'</span>,<br>});<br><br><span class="hljs-keyword">const</span> podletB = layout.client.register({<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodletB'</span>,<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7200/manifest.json'</span>,<br>});<br><br><span class="hljs-keyword">const</span> server = http.createServer(<span class="hljs-keyword">async</span> (req, res) =&gt; {<br>    <span class="hljs-keyword">let</span> incoming = <span class="hljs-keyword">new</span> HttpIncoming(req, res);<br>    incoming = <span class="hljs-keyword">await</span> layout.process(incoming);<br><br>    <span class="hljs-keyword">if</span> (incoming.url.pathname === layout.pathname()) {<br><br>        <span class="hljs-keyword">const</span> [a, b] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([<br>            podletA.fetch(incoming),<br>            podletB.fetch(incoming),<br>        ]);<br><br>        res.statusCode = <span class="hljs-number">200</span>;<br>        res.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/html'</span>);<br><br>        res.end(podlet.render(incoming, <span class="hljs-string">`<br>            &lt;section&gt;<span class="hljs-subst">${a.content}</span>&lt;/section&gt;<br>            &lt;section&gt;<span class="hljs-subst">${b.content}</span>&lt;/section&gt;<br>        `</span>));<br>        <span class="hljs-keyword">return</span>;<br>    }<br><br>    res.statusCode = <span class="hljs-number">404</span>;<br>    res.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/plain'</span>);<br>    res.end(<span class="hljs-string">'Not found'</span>);<br>});<br><br>server.listen(<span class="hljs-number">7000</span>);<br></code></pre>
</span></div></div></div></div>

Start the Layout and it will be accessable on http://localhost:7000/